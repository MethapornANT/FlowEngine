graph TD
    D_Start((เข้าสู่ D: เตรียม/รวมข้อมูล)) --> D1{ข้อมูลลูกค้าครบถ้วน?};
    
    D1 -- ขาด --> D2[ดึง Customer จาก CSC];
    
    D2 --> D3{เจอ Customer ใน CSC?};
    
    D3 -- ไม่เจอ --> D4_Err[Log/Alert: ข้อมูลลูกค้าขาดหาย];
    D4_Err --> D_Manual[ส่งไป X: Manual Handle];
    D_Manual --> D_End((จบ D));
    
    D3 -- เจอ --> D5_Merge[รวม Customer เข้ากับชุดข้อมูล];
    D5_Merge --> D5_Check{รวมข้อมูลสำเร็จ?};
    
    D5_Check -- ไม่สำเร็จ --> D5_Log_Err[Log Error: รวมข้อมูลล้มเหลว];
    D5_Log_Err --> D_End;
    
    D5_Check -- สำเร็จ --> D5_Log_OK[Log: รวมข้อมูลสำเร็จ];
    D5_Log_OK --> D1;
    
    D1 -- ครบถ้วน --> E_Start[ส่งต่อไปยัง E: Mapping];