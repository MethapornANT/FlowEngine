graph TD
    A((Start)) --> B_Check{กระบวนการพร้อมทำงาน?};
    
    %% S1: รายละเอียดของ B (ตรวจสอบความพร้อมและการทำ Log)
    subgraph S1 [รายละเอียดของ B: ตรวจสอบความพร้อม]
        B_Check --> B1{ถึงเวลาตาม Schedule?};
        
        B1 -- ไม่ถึงเวลา --> B1_Log[บันทึก Log: ยังไม่ถึงรอบเวลา]; 
        B1_Log --> B_NotReady((ไม่พร้อม)); 
        
        B1 -- ถึงเวลา --> B2{ดึงสถานะล่าสุด?}; 
        B2 --> B3{สถานะล่าสุดประมวลผลเสร็จสมบูรณ์?};

        B3 -- ไม่สมบูรณ์ --> B4_Log[บันทึก Log: สถานะล้มเหลว];
        B4_Log --> B5[ส่งแจ้งเตือน Error ไปที่ Admin];
        B5 --> B_NotReady;

        B3 -- สมบูรณ์ --> B_Log_S[บันทึก Log: ระบบพร้อมทำงาน];
        B_Log_S --> B_Ready((พร้อม)); 
    end
    
    %% เชื่อมจาก Subgraph B ไป Flow หลัก
    B_NotReady --> H[รอรอบถัดไป];
    B_Ready --> C[ดึงข้อมูล CSC];
    
    %% การจัดการ Loop และ Waiting Time หลัก
    H --> A;
    
    C --> D_Start;

    %% S2: รายละเอียดของ D (ตรวจสอบ/สร้างข้อมูลลูกค้า และการทำ Log)
    subgraph S2 [รายละเอียดของ D: ตรวจสอบ/สร้างข้อมูลลูกค้า]
        D_Start((เข้าสู่ D)) --> D1{ตรวจสอบลูกค้า WinSpeed มีอยู่แล้วหรือไม่?};
        
        D1 -- มีแล้ว --> D2{ตรวจสอบผู้ติดต่อ WinSpeed มีอยู่แล้วหรือไม่?};
        
        D1 -- ไม่มี --> D3[เพิ่มชื่อลูกค้าใหม่ใน WinSpeed - ใช้ข้อมูล CSC]; 
        D3 --> D3_Log[บันทึก Log: สร้างลูกค้าใหม่]; 
        D3_Log --> D2; 
        
        D2 -- มีแล้ว --> D4[เรียก API เพื่อสร้างรหัสเอกสารใหม่];
        
        D2 -- ไม่มี --> D5[เพิ่มชื่อผู้ติดต่อใหม่ใน WinSpeed - ใช้ข้อมูล CSC];
        D5 --> D5_Log[บันทึก Log: สร้างผู้ติดต่อใหม่];
        D5_Log --> D4; 
    end
    
    D4 --> E[เพิ่มข้อมูล WinSpeed];
    
    E --> E_Log[บันทึก Log: ประมวลผลสำเร็จ];
    
    E_Log --> G((End));
    G --> H;