graph TD
A[เริ่ม ErrorHandler] --> B{มี Response ไหม}
B -- ไม่มี --> T[Transport Error เช่น Timeout หรือ Network]
B -- มี --> C{Status Code}

C -- 200 ถึง 299 --> S[SUCCESS]
C -- 408 หรือ 429 หรือ 500 หรือ 502 หรือ 503 หรือ 504 --> R[Retryable Error]
C -- 400 หรือ 401 หรือ 403 หรือ 404 หรือ 422 --> N[Non Retry Error]
C -- อื่นๆ --> U[Unknown Error]

T --> Lr[Log ชื่อ API และ ErrorCode สำหรับ Retry]
R --> Lr
N --> Ln[Log ชื่อ API และ ErrorCode สำหรับ Non Retry]
U --> Ln
S --> Ls[Log ชื่อ API และ SUCCESS]


Ln --> D[ส่งผลลัพธ์ DeadQueue]

Lr --> AC[เพิ่ม attemptCount ของ Record นี้ +1]
AC --> M{attemptCount ถึง MaxRetry หรือยัง}
M -- ใช่ --> D
M -- ไม่ --> ZR[ส่งผลลัพธ์ RETRY]
